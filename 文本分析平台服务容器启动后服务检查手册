NLP服务container启动后需要检查服务是否正常

一、mysql - mysql官方镜像自管理
    1、客户端连接测试是否启动成功
    2、telnet ip port 测试
  
二、es - es镜像现有维护自启动和非自启动两个版本
  1、版本判断
      在es容器/etc/目录下存在supervisord.conf的版本为自启版本，否则为非自启版本
  2、自启动版本supervisord基本操作命令
      ```
        supervisord -c /etc/supervisor/supervisord.conf此时默认开启了所有服务
        supervisorctl status 查看进程运行状态
        supervisorctl start 进程名 启动进程
        supervisorctl stop 进程名 关闭进程
        supervisorctl restart 进程名 重启进程
        supervisorctl update 重新载入配置文件
        supervisorctl shutdown 关闭supervisord
        supervisorctl clear 进程名 清空进程日志
        supervisorctl 进入到交互模式下。使用help查看所有命令。
        start stop restart + all 表示启动，关闭，重启所有进程。

        关闭服务：
          supervisorctl stop all先关闭supervisor服务
          之后再关闭supervisord服务 kill -9 pid
      ```
  3、手动启动版本启动命令
      ```
      手动启动es时需要先切换用户 su - elsearch
      启动elasticsearch
        cd /usr/local/elasticsearch-6.5.4/bin
        ./elasticsearch -d
        ps -ef|grep elasticsearch
      启动kinaba
        cd /usr/local/kibana-6.5.4-linux-x86_64/bin
        nohup ./kibana &
        lsof -i:5601
      ```
  4、浏览器访问检查服务启动情况
      http://10.0.3.25:29200/
      http://10.0.3.25:25601/app/kibana 
      
三、bert - 需手动启动服务
    1、bert启动方式：
      进入bert容器 
      cd /opt/bert/sbin 
      nohup sh sstart.sh &
    2、检查bert服务启动情况
      telnet 10.0.3.25 25555


四、redis - 客户端检查
  1、redis启动方式：
    cd /usr/local/redis/bin
    nohup ./redis-server &

五、master - NLP主服务
  1、NLP服务启动操作步骤
    - cd /opt/CWTAP
    - 修改配置 
        - 先检查sbin/init_ip.sh脚本配置情况，做ip:port的对应修改
        - sh sbin/init_ip.sh 
    - 检查配置修改情况 
        cwtap/settings.py
        webroot/WEB-INF/classes/common.properties
    - 创建cwtap/cenlp mysql数据库
    - 初始化数据库
        - sh sbin/cwtap.sh init mysql 
    - 生成最新的菜单数据(需根据实际菜单数据情况而定）
        - python users/fixtures/create_json.py
        - 将生成的00.initialize_user_data.20210630173812.json文件修改为00.initialize_user_data.json文件
    - 加载fixtures文件数据
         - sh sbin/cwtap.sh init fixtures
    - 构建es索引
        - sh sbin/cwtap.sh init es 
    - 启动nginx
        - cd /usr/local/nginx
        - sbin/nginx
    - 启动java服务
        - sh sbin/cwtap.sh start tomcat
    - 启动Django项目
        - sh sbin/cwtap.sh start python
    - 启动websocket服务
        - sh sbin/cwtap.sh start daphne
    - 启动celery服务
        - sh sbin/cwtap.sh start celery
    - 启动logstash（注意：需要将logstash复制一份来启动两个服务)
        - nohup logstash-5.5.1/bin/logstash -f input_output_test.conf &
        - nohup logstash-5.5.1/bin/logstash -f hot-degree.conf &
  
问题记录：以下问题在新部署的环境中可能会存在（智汇核1.9版本）
  - elk镜像中缺少logstash配置（已修复）
  - 检查master服务中是否有node.js环境
    * 可能存在的问题是对话中存在js代码执行时报错，缺少node.js环境
  - 检查master中/mnt/mfs/nlp_templates/目录是否存在
    * 可能存在上传模版下载失败的问题，缺少nlp_templates目录
  - 检查cwtap/core/es_models.py 中HotWordsTaskReport类是否正常
    * 热词分析任务写入es索引时报错，原因是es_models.py中热词报告类异常
  - 检查cwtap/core/es_models.py 中TextClusterTaskReport类中coupus字段是否是Text类型
    * 文本聚类任务执行时报错，原因是coupus字段字符长度超限，keyword的最大字符长度为32766个UTF-8字符，而text没有限制
  - 检查平台/cwtap/schedule/定时任务是否启动
    * 可能存在对话知识、闲聊热度数据为空、资源生效时间、失效时间无效、对话session超时未关的现象
  - 检查词库fixtures文件中是否缺少纠错通用词库及创建租户时默认创建的词库是否包含纠错词库
    * 可能存在纠错词库中没有通用词库、新创建的租户的纠错词库也没有通用词库的现象
  - 检查 settings.py 文件中配置
    ANNOTATE_MARKER_CODE_LIST = ["05070304", "05070305"]  # 标注员
    ANNOTATE_CHECKER_CODE_LIST = ["05070306", "05070307"]  # 审核员
    * 可能存在创建标注任务时没办法选择新创建的标注员和审核员
    
